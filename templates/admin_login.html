<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BNGX PANEL - Admin Access</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<style>
body { font-family: 'Fira Code', monospace; background: #0d0d0d; color: #00ff99; overflow-x:hidden; }
.glitch-text { position: relative; color: #00ff99; font-size: 32px; font-weight:700; }
.glitch-text::before,.glitch-text::after { content: attr(data-text); position:absolute; left:0; top:0; opacity:0.8; }
.glitch-text::before { left:2px; text-shadow:-2px 0 #f0f; animation: glitchTop 2s infinite linear alternate-reverse; }
.glitch-text::after { left:-2px; text-shadow:-2px 0 #0ff; animation: glitchBottom 2s infinite linear alternate-reverse; }
@keyframes glitchTop { 0% { clip: rect(0,9999px,0,0); } 5% { clip: rect(0,9999px,5px,0); } 10% { clip: rect(0,9999px,0,0); } 15% { clip: rect(0,9999px,5px,0); } 100% { clip: rect(0,9999px,0,0); } }
@keyframes glitchBottom { 0% { clip: rect(5px,9999px,9999px,0); } 5% { clip: rect(5px,9999px,9999px,0); } 10% { clip: rect(5px,9999px,9999px,0); } 100% { clip: rect(5px,9999px,9999px,0); } }
.tool-section { padding: 30px 20px; background: rgba(0,0,0,0.7); margin:20px 0; border-radius:12px; }
.input-group { margin-bottom:15px; }
.input-field { width:100%; padding:8px 10px; border-radius:6px; border:1px solid #00ff99; background:#111; color:#00ff99; }
.btn { padding:8px 16px; border:none; border-radius:6px; background:linear-gradient(90deg,#ff00ff,#00ffff); color:#000; cursor:pointer; font-weight:600; }
.status-message { color:#ff5555; font-weight:500; margin-top:5px; }
.login-container, #challenge-box { max-width:500px; margin:auto; text-align:center; }
#challenge-box { padding:20px; border:1px solid #00ff99; border-radius:12px; background: rgba(0,0,0,0.6); margin-top:50px; }
#login-container { display:none; padding:20px; border:1px solid #00ff99; border-radius:12px; background: rgba(0,0,0,0.6); margin-top:50px; }
</style>
</head>
<body>
<canvas id="matrix-canvas"></canvas>

<!-- CAPTCHA -->
<div id="challenge-box" class="tool-section">
    <h2 class="glitch-text" data-text="CODEX Security">BNGX Security</h2>
    <p id="challenge-question">تحميل السؤال...</p>
    <input type="number" id="answer-input" class="input-field" placeholder="أدخل الإجابة هنا..." />
    <button id="verify-btn" class="btn">تحقق</button>
    <div id="challenge-message" class="status-message"></div>
</div>

<!-- LOGIN -->
<div id="login-container">
    <h2 class="glitch-text" data-text="Admin Access">Admin Access</h2>
    <form id="admin-login-form">
        <div class="input-group">
            <label>Admin Username</label>
            <input type="text" id="admin-username" class="input-field" placeholder="Enter admin username..." required>
        </div>
        <div class="input-group">
            <label>Master Password</label>
            <input type="password" id="admin-password" class="input-field" placeholder="Enter master password..." required>
        </div>
        <button type="submit" class="btn">Access Admin Panel</button>
    </form>
    <div id="error-message" class="status-message"></div>
    <div id="success-message" class="status-message"></div>

    <!-- Team Section -->
    <section id="team" class="tool-section">
        <h2 class="glitch-text" data-text="BNGX">BNGX</h2>
        <div class="team-grid">
            <div class="team-card">
                <div class="profile-img purple-border">
                    <img src="{{ url_for('static', filename='images/E915864E-4C38-4EFA-96E0-E13ECA51DFEA_1755810001562.jpeg') }}" alt="BNGX Profile" />
                </div>
                <h3 class="dev-name purple-text">BNGX</h3>
                <p class="dev-role">BNGX PANEL</p>
                <p class="dev-description">Site creator</p>
                <a href="https://t.me/BNGXXXX" target="_blank" class="btn btn-telegram purple">
                    <i class="fab fa-telegram-plane"></i> Contact via Telegram
                </a>
            </div>
        </div>
    </section>
</div>

<script>
const challengeBox = document.getElementById('challenge-box');
const loginContainer = document.getElementById('login-container');
const verifyBtn = document.getElementById('verify-btn');
const answerInput = document.getElementById('answer-input');
const challengeMessage = document.getElementById('challenge-message');
const loginForm = document.getElementById('admin-login-form');
const errorMsg = document.getElementById('error-message');
const successMsg = document.getElementById('success-message');

let question = "";
let attempts = 0;
const maxAttempts = 3;

function showMessage(element,msg,isError){
    element.textContent = msg;
    element.style.color = isError?'#ff5555':'#00ff99';
}
async function loadChallenge(){
    try{
        const res = await fetch('/api/security/generate-challenge');
        const data = await res.json();
        question = data.question;
        document.getElementById('challenge-question').textContent=`حل المعادلة: ${question}`;
        answerInput.value="";
        challengeMessage.style.display="none";
        verifyBtn.disabled=false;
    }catch{document.getElementById('challenge-question').textContent="فشل في تحميل السؤال.";}
}
async function verifyAnswer(){
    let answer = answerInput.value.trim();
    if(answer===""){showMessage(challengeMessage,"الرجاء إدخال الإجابة",true);return;}
    verifyBtn.disabled=true;
    try{
        const res=await fetch('/api/security/verify-human',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({answer})});
        const data=await res.json();
        if(res.ok && data.success){
            showMessage(challengeMessage,data.message,false);
            setTimeout(()=>{challengeBox.style.display='none';loginContainer.style.display='block';},1000);
        } else { attempts++; if(attempts>=maxAttempts){showMessage(challengeMessage,"تم حظرك مؤقتًا",true); setTimeout(()=>{window.location.href='/security/blocked';},3000);} else {showMessage(challengeMessage,data.message||"خطأ",true); await loadChallenge();} }
    }catch{showMessage(challengeMessage,"خطأ أثناء التحقق",true);}
    finally{verifyBtn.disabled=false;}
}
verifyBtn.addEventListener('click',verifyAnswer);
answerInput.addEventListener('keypress',e=>{if(e.key==='Enter')verifyAnswer();});
loginForm.addEventListener('submit',async(e)=>{
    e.preventDefault();
    const username=document.getElementById('admin-username').value.trim();
    const password=document.getElementById('admin-password').value.trim();
    try{
        const response=await fetch('/admin/authenticate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
        const data=await response.json();
        if(data.success){ showMessage(successMsg,'تم تسجيل الدخول',false); sessionStorage.setItem('admin_session',data.session_id); setTimeout(()=>{window.location.href='/';},1000); }
        else { showMessage(errorMsg,data.message||'فشل في تسجيل الدخول',true); loginForm.reset(); }
    }catch{showMessage(errorMsg,'خطأ في الاتصال',true);}
});
loadChallenge();

// MATRIX BACKGROUND
const canvas=document.getElementById('matrix-canvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%'.split('');
const fontSize=16;
const columns=Math.floor(canvas.width/fontSize);
const drops=Array(columns).fill(1);

function drawMatrix(){
    ctx.fillStyle='rgba(0,0,0,0.05)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#0F0';
    ctx.font=fontSize+'px monospace';
    for(let i=0;i<drops.length;i++){
        const text=letters[Math.floor(Math.random()*letters.length)];
        ctx.fillText(text,i*fontSize,drops[i]*fontSize);
        if(drops[i]*fontSize>canvas.height && Math.random()>0.975){drops[i]=0;}
        drops[i]++;
    }
}
setInterval(drawMatrix,50);
window.addEventListener('resize',()=>{
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
});
</script>
</body>
</html>